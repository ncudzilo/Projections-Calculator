<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reneu Projections Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-base: #0a0908;
            --bg-gradient-1: #0f0e0d;
            --bg-gradient-2: #141312;
            --brand: #f8cc74;
            --brand-soft: rgba(248, 204, 116, 0.6);
            --brand-glow: rgba(248, 204, 116, 0.08);
            --brand-glow-subtle: rgba(248, 204, 116, 0.04);
            --brand-border: rgba(248, 204, 116, 0.12);
            --brand-border-hover: rgba(248, 204, 116, 0.2);
            --text-primary: rgba(255, 255, 255, 0.92);
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.35);
            --positive: #6ee7b7;
            --negative: #fca5a5;
            --card-shadow: 0 4px 24px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(248, 204, 116, 0.06);
            --card-shadow-hover: 0 8px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(248, 204, 116, 0.12), 0 0 60px rgba(248, 204, 116, 0.06);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-base) 0%, var(--bg-gradient-1) 50%, var(--bg-gradient-2) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }
        
        /* Enhanced ambient background */
        .bg-glow {
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse 120% 80% at 10% 0%, rgba(248, 204, 116, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse 80% 60% at 90% 100%, rgba(248, 204, 116, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse 100% 50% at 50% 50%, rgba(248, 204, 116, 0.02) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Logo */
        .logo-container {
            position: fixed;
            top: 24px;
            left: 24px;
            z-index: 100;
            transition: all 0.4s ease;
        }
        
        .logo-container.scrolled {
            top: 12px;
            left: 12px;
        }
        
        .logo-svg {
            height: 90px;
            width: auto;
            transition: all 0.4s ease;
            filter: drop-shadow(0 0 20px rgba(248, 204, 116, 0.2));
        }
        
        .logo-container.scrolled .logo-svg {
            height: 60px;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 90px 20px 40px 20px;
            position: relative;
            z-index: 2;
        }
        
        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }
        
        .page-subtitle {
            font-size: 0.8rem;
            font-weight: 500;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--brand);
            opacity: 0.7;
        }
        
        /* Enhanced Glass Panels */
        .glass-panel {
            position: relative;
            background: linear-gradient(135deg, 
                rgba(248, 204, 116, 0.03) 0%, 
                rgba(248, 204, 116, 0.015) 50%,
                rgba(248, 204, 116, 0.025) 100%);
            border: 1px solid var(--brand-border);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 50% 0%, rgba(248, 204, 116, 0.04) 0%, transparent 60%);
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }
        
        .glass-panel:hover {
            border-color: var(--brand-border-hover);
            box-shadow: var(--card-shadow-hover);
            transform: translateY(-2px);
        }
        
        .glass-panel:hover::before {
            opacity: 1;
        }
        
        /* Inline mini toggle */
        .mini-toggle {
            width: 80px;
            height: 28px;
            margin-left: 8px;
            position: relative;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 14px;
            border: 1px solid rgba(248, 204, 116, 0.15);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
            display: inline-block;
            vertical-align: middle;
        }
        
        .mini-toggle:hover {
            border-color: rgba(248, 204, 116, 0.25);
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4), 0 0 12px rgba(248, 204, 116, 0.1);
        }
        
        .mini-toggle .toggle-option {
            position: absolute;
            top: 4px;
            width: 36px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2;
            pointer-events: none;
        }
        
        .mini-toggle .toggle-option.left { left: 4px; }
        .mini-toggle .toggle-option.right { right: 4px; }
        
        .mini-toggle .toggle-slider {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 36px;
            height: 20px;
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.3) 0%, rgba(248, 204, 116, 0.2) 100%);
            border: 1px solid rgba(248, 204, 116, 0.4);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(248, 204, 116, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.1);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }
        
        .mini-toggle.active .toggle-slider {
            transform: translateX(36px);
        }
        
        .mini-toggle.active .toggle-option.right,
        .mini-toggle:not(.active) .toggle-option.left {
            color: var(--brand);
            font-weight: 700;
        }
        
        /* Input Sections */
        .input-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .input-panel { padding: 28px; }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 24px;
        }
        
        .panel-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.1) 0%, rgba(248, 204, 116, 0.05) 100%);
            box-shadow: 0 2px 12px rgba(248, 204, 116, 0.15);
        }
        
        .panel-icon svg {
            width: 22px;
            height: 22px;
            stroke: var(--brand);
            stroke-width: 1.5;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .panel-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .inputs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .input-group { display: flex; flex-direction: column; }
        
        .input-group label {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .input-group input[type="number"] {
            width: 100%;
            padding: 12px 14px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(248, 204, 116, 0.12);
            border-radius: 10px;
            font-size: 0.95rem;
            font-family: inherit;
            color: var(--text-primary);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .input-group input[type="number"]:focus {
            outline: none;
            border-color: rgba(248, 204, 116, 0.3);
            background: rgba(0, 0, 0, 0.6);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(248, 204, 116, 0.1);
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, rgba(248, 204, 116, 0.2) 0%, rgba(248, 204, 116, 0.05) 100%);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, var(--brand) 0%, rgba(248, 204, 116, 0.9) 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(248, 204, 116, 0.4);
            transition: all 0.2s ease;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 12px rgba(248, 204, 116, 0.6);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, var(--brand) 0%, rgba(248, 204, 116, 0.9) 100%);
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(248, 204, 116, 0.4);
            transition: all 0.2s ease;
        }
        
        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 12px rgba(248, 204, 116, 0.6);
        }
        
        .section-label {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--brand);
            opacity: 0.6;
            margin-top: 12px;
            grid-column: 1 / -1;
        }
        
        /* Compact Accordion/Tier Sections */
        .tier-section {
            margin-top: 12px;
            border-top: 1px solid rgba(248, 204, 116, 0.06);
            padding-top: 12px;
        }
        
        .tier-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(248, 204, 116, 0.1);
            transition: all 0.2s ease;
            margin-bottom: 8px;
        }
        
        .tier-header:hover {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(248, 204, 116, 0.2);
        }
        
        .tier-header-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tier-badge {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.2) 0%, rgba(248, 204, 116, 0.1) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--brand);
        }
        
        .tier-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .tier-chevron {
            width: 14px;
            height: 14px;
            transition: transform 0.2s ease;
        }
        
        .tier-chevron svg {
            stroke: var(--brand);
            stroke-width: 2;
        }
        
        .tier-header.active .tier-chevron {
            transform: rotate(180deg);
        }
        
        .tier-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.2s ease;
            opacity: 0;
        }
        
        .tier-content.active {
            max-height: 400px;
            opacity: 1;
            margin-bottom: 8px;
        }
        
        .tier-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .tier-inputs .input-group label {
            font-size: 0.65rem;
            margin-bottom: 6px;
        }
        
        .tier-inputs .input-group input[type="number"] {
            padding: 8px 10px;
            font-size: 0.85rem;
        }
        
        .tier-inputs .input-group input[type="range"] {
            height: 5px;
        }
        
        /* Results */
        .results-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Insights Bar - 7 columns */
        .insights-bar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 14px;
        }
        
        .insight-item {
            padding: 22px 16px;
            text-align: center;
        }
        
        .insight-label {
            font-size: 0.58rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .insight-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--brand);
            text-shadow: 0 0 20px rgba(248, 204, 116, 0.3);
        }
        
        .insight-value.positive { color: var(--positive); }
        .insight-value.negative { color: var(--negative); }
        
        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
        }
        
        .metric-card { 
            padding: 26px; 
            text-align: center;
        }
        
        .metric-card.highlight {
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.06) 0%, rgba(248, 204, 116, 0.02) 100%);
        }
        
        .metric-label {
            font-size: 0.58rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 14px;
        }
        
        .metric-value {
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }
        
        .metric-card.highlight .metric-value {
            color: var(--brand);
            text-shadow: 0 0 20px rgba(248, 204, 116, 0.3);
        }
        
        .metric-subtext {
            font-size: 0.65rem;
            color: var(--text-muted);
        }
        
        /* Year Selector */
        .year-selector {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .year-btn {
            padding: 10px 24px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(248, 204, 116, 0.15);
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .year-btn:hover {
            border-color: rgba(248, 204, 116, 0.25);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 0 12px rgba(248, 204, 116, 0.1);
        }
        
        .year-btn.active {
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.3) 0%, rgba(248, 204, 116, 0.2) 100%);
            border-color: rgba(248, 204, 116, 0.4);
            color: var(--brand);
            box-shadow: 0 2px 8px rgba(248, 204, 116, 0.2), inset 0 1px 2px rgba(255, 255, 255, 0.1);
        }
        
        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .chart-container { padding: 24px; }
        
        .chart-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 18px;
        }
        
        /* Table */
        .table-container { padding: 24px; overflow-x: auto; }
        
        .table-container h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 18px;
        }
        
        table { width: 100%; border-collapse: collapse; }
        
        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(248, 204, 116, 0.06);
            font-size: 0.8rem;
        }
        
        th {
            font-size: 0.58rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            font-weight: 600;
            background: rgba(0, 0, 0, 0.3);
        }
        
        tr:hover td { 
            background: rgba(248, 204, 116, 0.03);
        }
        
        .positive { color: var(--positive); font-weight: 600; }
        .negative { color: var(--negative); font-weight: 600; }
        
        .breakeven-row td {
            background: rgba(248, 204, 116, 0.06) !important;
            border-left: 3px solid var(--brand);
        }
        
        /* Disclaimer */
        .disclaimer { padding: 20px 24px; }
        
        .disclaimer-title {
            font-size: 0.58rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--brand);
            opacity: 0.7;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .disclaimer-title svg {
            width: 14px;
            height: 14px;
            stroke: var(--brand);
            stroke-width: 1.5;
            fill: none;
        }
        
        .disclaimer-text {
            font-size: 0.65rem;
            line-height: 1.7;
            color: var(--text-muted);
        }
        
        .disclaimer-text strong { color: var(--text-secondary); font-weight: 500; }
        
        /* 3D PHOTON SPHERE ORB */
        .tour-orb {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 72px;
            height: 72px;
            cursor: pointer;
            z-index: 10000;
            transition: all 0.4s ease;
            perspective: 1000px;
        }
        
        .tour-orb-sphere {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 245, 215, 0.15) 0%,
                rgba(248, 204, 116, 0.08) 25%,
                rgba(248, 204, 116, 0.04) 50%,
                rgba(10, 9, 8, 0.8) 75%,
                rgba(0, 0, 0, 0.95) 100%
            );
            box-shadow: 
                inset 0 -8px 20px rgba(0, 0, 0, 0.4),
                inset 0 8px 20px rgba(255, 255, 255, 0.08),
                0 4px 20px rgba(248, 204, 116, 0.3);
            transform-style: preserve-3d;
            animation: sphereRotate 20s linear infinite;
        }
        
        @keyframes sphereRotate {
            0% { transform: rotateY(0deg) rotateX(5deg); }
            100% { transform: rotateY(360deg) rotateX(5deg); }
        }
        
        .tour-orb-particles {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            overflow: visible;
            transform-style: preserve-3d;
        }
        
        .particle {
            position: absolute;
            width: 1.5px;
            height: 1.5px;
            background: radial-gradient(circle, rgba(255, 250, 230, 1) 0%, rgba(248, 204, 116, 0.8) 40%, transparent 70%);
            border-radius: 50%;
            filter: blur(0.3px);
            box-shadow: 0 0 3px rgba(248, 204, 116, 0.6);
            animation: photonFloat 3s ease-in-out infinite;
        }
        
        @keyframes photonFloat {
            0%, 100% { 
                transform: translate(0, 0) scale(1);
                opacity: 0.8;
            }
            25% { 
                transform: translate(1px, -1px) scale(1.1);
                opacity: 1;
            }
            50% { 
                transform: translate(-0.5px, 0.5px) scale(0.9);
                opacity: 0.7;
            }
            75% { 
                transform: translate(-1px, -0.5px) scale(1.05);
                opacity: 0.9;
            }
        }
        
        .tour-orb-glow {
            position: absolute;
            inset: -24px;
            background: radial-gradient(circle, 
                rgba(248, 204, 116, 0.25) 0%, 
                rgba(248, 204, 116, 0.12) 30%,
                rgba(248, 204, 116, 0.04) 50%,
                transparent 70%
            );
            animation: glowPulse 3s ease-in-out infinite;
            filter: blur(16px);
            border-radius: 50%;
        }
        
        @keyframes glowPulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.6;
            }
            50% { 
                transform: scale(1.12);
                opacity: 0.35;
            }
        }
        
        .tour-orb-highlight {
            position: absolute;
            top: 12%;
            left: 25%;
            width: 35%;
            height: 35%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 60%);
            border-radius: 50%;
            filter: blur(8px);
            opacity: 0.6;
        }
        
        .tour-orb-label {
            position: absolute;
            right: 84px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(10, 9, 8, 0.95);
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--brand);
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            border: 1px solid rgba(248, 204, 116, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        
        .tour-orb:hover .tour-orb-label { 
            opacity: 1; 
            transform: translateY(-50%) translateX(-4px); 
        }
        
        .tour-orb:hover .tour-orb-sphere { 
            animation-duration: 15s;
            box-shadow: 
                inset 0 -8px 20px rgba(0, 0, 0, 0.4),
                inset 0 8px 20px rgba(255, 255, 255, 0.12),
                0 6px 30px rgba(248, 204, 116, 0.5);
        }
        
        .tour-orb.touring { 
            width: 48px; 
            height: 48px; 
        }
        
        .tour-orb.touring .tour-orb-glow { inset: -16px; }
        .tour-orb.touring .tour-orb-label { display: none; }
        
        /* LIQUID GLASS TOOLTIP - Faster transitions for mobile */
        .tour-tooltip {
            position: fixed;
            background: linear-gradient(135deg, 
                rgba(20, 18, 16, 0.75) 0%, 
                rgba(15, 14, 13, 0.8) 50%,
                rgba(18, 16, 14, 0.75) 100%
            );
            backdrop-filter: blur(32px) saturate(180%);
            -webkit-backdrop-filter: blur(32px) saturate(180%);
            border: 1px solid rgba(248, 204, 116, 0.25);
            border-radius: 20px;
            padding: 28px 32px;
            max-width: 380px;
            z-index: 9999;
            box-shadow: 
                0 28px 100px rgba(0, 0, 0, 0.8), 
                0 0 0 1px rgba(248, 204, 116, 0.2),
                inset 0 1px 3px rgba(255, 255, 255, 0.15),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(12px);
            transition: opacity 0.2s ease, transform 0.2s ease;
            pointer-events: none;
        }
        
        .tour-tooltip::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            background: radial-gradient(circle at 30% 20%, 
                rgba(248, 204, 116, 0.12) 0%, 
                transparent 50%);
            pointer-events: none;
        }
        
        .tour-tooltip::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.08) 0%,
                transparent 20%,
                transparent 80%,
                rgba(0, 0, 0, 0.1) 100%
            );
            pointer-events: none;
        }
        
        .tour-tooltip.visible { 
            opacity: 1; 
            transform: translateY(0); 
            pointer-events: auto; 
        }
        
        .tour-tooltip-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: var(--brand);
            margin-bottom: 14px;
            text-shadow: 0 0 24px rgba(248, 204, 116, 0.4);
            position: relative;
            z-index: 1;
        }
        
        .tour-tooltip-text {
            font-size: 0.9rem;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 24px;
            position: relative;
            z-index: 1;
        }
        
        .tour-tooltip-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .tour-progress { 
            font-size: 0.72rem; 
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .tour-buttons { display: flex; gap: 10px; }
        
        .tour-btn {
            padding: 12px 22px;
            border-radius: 11px;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tour-btn.skip {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-muted);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tour-btn.skip:hover { 
            border-color: rgba(255, 255, 255, 0.25); 
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.6);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .tour-btn.next {
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.4) 0%, rgba(248, 204, 116, 0.3) 100%);
            border: 1px solid rgba(248, 204, 116, 0.5);
            color: var(--brand);
            box-shadow: 0 4px 14px rgba(248, 204, 116, 0.25), inset 0 1px 2px rgba(255, 255, 255, 0.15);
        }
        
        .tour-btn.next:hover { 
            background: linear-gradient(135deg, rgba(248, 204, 116, 0.5) 0%, rgba(248, 204, 116, 0.4) 100%);
            box-shadow: 0 6px 18px rgba(248, 204, 116, 0.35), inset 0 1px 3px rgba(255, 255, 255, 0.2);
            border-color: rgba(248, 204, 116, 0.6);
        }
        
        .tour-highlight {
            position: relative;
            z-index: 9998;
            box-shadow: 0 0 0 4px rgba(248, 204, 116, 0.3), 0 12px 40px rgba(0, 0, 0, 0.4) !important;
        }
        
        .tour-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
            z-index: 9997;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .tour-overlay.visible { opacity: 1; pointer-events: auto; }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .input-sections { grid-template-columns: 1fr; }
            .insights-bar { grid-template-columns: repeat(4, 1fr); }
        }
        
        @media (max-width: 768px) {
            html { overflow-x: hidden; }
            body { 
                overflow-x: hidden; 
                width: 100%; 
                position: relative;
            }
            .container { 
                padding: 80px 16px 32px 16px; 
                width: 100%;
                max-width: 100%;
            }
            .page-title { font-size: 1.5rem; }
            .insights-bar { grid-template-columns: repeat(2, 1fr); }
            .metrics-grid { grid-template-columns: 1fr; }
            .charts-row { grid-template-columns: 1fr; }
            .logo-container { top: 16px; left: 16px; }
            .logo-container.scrolled { top: 10px; left: 10px; }
            .logo-svg { height: 70px; }
            .logo-container.scrolled .logo-svg { height: 50px; }
            .tour-orb { bottom: 20px; right: 20px; width: 60px; height: 60px; }
            .tour-orb-label { display: none; }
            .tour-tooltip { 
                max-width: calc(100vw - 32px); 
                left: 16px !important; 
                right: 16px !important;
                padding: 20px 24px;
            }
        }
        
        @media (max-width: 480px) {
            .inputs-grid { grid-template-columns: 1fr; }
            .tier-inputs { grid-template-columns: 1fr; }
            .insights-bar { grid-template-columns: 1fr; }
            .year-selector { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    
    <!-- Logo -->
    <div class="logo-container" id="logoContainer">
        <img src="logo.svg" alt="Reneu" class="logo-svg">
    </div>
    
    <div class="tour-overlay" id="tourOverlay"></div>
    
    <div class="tour-orb" id="tourOrb" onclick="startTour()">
        <div class="tour-orb-glow"></div>
        <div class="tour-orb-sphere">
            <div class="tour-orb-highlight"></div>
        </div>
        <div class="tour-orb-particles" id="particles"></div>
        <div class="tour-orb-label">Take a Tour</div>
    </div>
    
    <div class="tour-tooltip" id="tourTooltip">
        <div class="tour-tooltip-title" id="tooltipTitle">Welcome!</div>
        <div class="tour-tooltip-text" id="tooltipText">Let's take a quick tour.</div>
        <div class="tour-tooltip-footer">
            <span class="tour-progress" id="tourProgress">1 of 5</span>
            <div class="tour-buttons">
                <button class="tour-btn skip" onclick="endTour()">Skip</button>
                <button class="tour-btn next" onclick="nextTourStep()">Next</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-header" id="tourStep0">
            <h1 class="page-title">Projections Calculator</h1>
            <p class="page-subtitle">Hybrid Revenue & Capacity Analysis</p>
        </div>
        
        <!-- Input Sections -->
        <div class="input-sections">
            <div class="input-panel glass-panel" id="tourStep1">
                <div class="panel-header">
                    <div class="panel-icon">
                        <svg viewBox="0 0 24 24">
                            <rect x="3" y="6" width="18" height="12" rx="2"/>
                            <path d="M 3 10h18"/>
                            <circle cx="17" cy="14" r="1.5"/>
                        </svg>
                    </div>
                    <h2 class="panel-title">Up-front Cost Model</h2>
                </div>
                <div class="inputs-grid">
                    <div class="input-group">
                        <label>Program Price ($)</label>
                        <input type="number" id="oldPrice" value="750" step="50">
                    </div>
                    <div class="input-group">
                        <label>Patients/Month: <span id="oldClientsVal">2</span></label>
                        <input type="range" id="oldClients" min="0" max="50" value="2" step="1">
                    </div>
                    <div class="section-label">Provider Capacity</div>
                    <div class="input-group">
                        <label>Hours/Week Available</label>
                        <input type="number" id="oldHoursPerWeek" value="20" step="1" min="1">
                    </div>
                    <div class="input-group">
                        <label>
                            <span id="oldPatientTimeLabel">Hours</span>/Patient
                            <div class="mini-toggle" id="oldTimeToggle" onclick="toggleOldTime()">
                                <div class="toggle-slider"></div>
                                <div class="toggle-option left">Mo</div>
                                <div class="toggle-option right">Qtr</div>
                            </div>
                        </label>
                        <input type="number" id="oldTimePerPatient" value="0.5" step="0.1" min="0.1">
                    </div>
                </div>
            </div>
            
            <div class="input-panel glass-panel" id="tourStep2">
                <div class="panel-header">
                    <div class="panel-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                            <path d="M21 3v5h-5"/>
                        </svg>
                    </div>
                    <h2 class="panel-title">Subscription Model</h2>
                </div>
                <div class="inputs-grid">
                    <div class="input-group">
                        <label>Monthly Price ($)</label>
                        <input type="number" id="newPrice" value="90" step="5">
                    </div>
                    <div class="input-group">
                        <label>Retention Rate: <span id="retentionVal">85%</span></label>
                        <input type="range" id="retention" min="50" max="100" value="85" step="1">
                    </div>
                    <div class="input-group">
                        <label>New Patients/Month: <span id="newClientsSteadyVal">8</span></label>
                        <input type="range" id="newClientsSteady" min="0" max="100" value="8" step="1">
                    </div>
                    <div class="input-group">
                        <label>Starting Patients: <span id="startingPatientsVal">0</span></label>
                        <input type="range" id="startingPatients" min="0" max="50" value="0" step="1">
                    </div>
                    <div class="section-label">Provider Capacity</div>
                    <div class="input-group">
                        <label>Hours/Week Available</label>
                        <input type="number" id="hoursPerWeek" value="20" step="1" min="1">
                    </div>
                    <div class="input-group">
                        <label>
                            <span id="newPatientTimeLabel">Hours</span>/Patient
                            <div class="mini-toggle" id="newTimeToggle" onclick="toggleNewTime()">
                                <div class="toggle-slider"></div>
                                <div class="toggle-option left">Mo</div>
                                <div class="toggle-option right">Qtr</div>
                            </div>
                        </label>
                        <input type="number" id="newTimePerPatient" value="0.5" step="0.1" min="0.1">
                    </div>
                </div>
                
                <!-- Tier Sections - Compact -->
                <div class="tier-section">
                    <div class="tier-header" onclick="toggleTier(2)">
                        <div class="tier-header-content">
                            <div class="tier-badge">T2</div>
                            <span class="tier-title">Tier 2</span>
                        </div>
                        <div class="tier-chevron">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                    </div>
                    <div class="tier-content" id="tier2Content">
                        <div class="tier-inputs">
                            <div class="input-group">
                                <label>Monthly Price ($)</label>
                                <input type="number" id="tier2Price" value="0" step="5">
                            </div>
                            <div class="input-group">
                                <label>New Patients/Mo: <span id="tier2ClientsVal">0</span></label>
                                <input type="range" id="tier2Clients" min="0" max="50" value="0" step="1" oninput="document.getElementById('tier2ClientsVal').textContent=this.value">
                            </div>
                            <div class="input-group">
                                <label>Retention Rate: <span id="tier2RetentionVal">85%</span></label>
                                <input type="range" id="tier2Retention" min="50" max="100" value="85" step="1" oninput="document.getElementById('tier2RetentionVal').textContent=this.value+'%'">
                            </div>
                            <div class="input-group">
                                <label>Hours/Patient/Mo</label>
                                <input type="number" id="tier2Time" value="0.75" step="0.1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tier-section">
                    <div class="tier-header" onclick="toggleTier(3)">
                        <div class="tier-header-content">
                            <div class="tier-badge">T3</div>
                            <span class="tier-title">Tier 3</span>
                        </div>
                        <div class="tier-chevron">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                    </div>
                    <div class="tier-content" id="tier3Content">
                        <div class="tier-inputs">
                            <div class="input-group">
                                <label>Monthly Price ($)</label>
                                <input type="number" id="tier3Price" value="0" step="5">
                            </div>
                            <div class="input-group">
                                <label>New Patients/Mo: <span id="tier3ClientsVal">0</span></label>
                                <input type="range" id="tier3Clients" min="0" max="50" value="0" step="1" oninput="document.getElementById('tier3ClientsVal').textContent=this.value">
                            </div>
                            <div class="input-group">
                                <label>Retention Rate: <span id="tier3RetentionVal">90%</span></label>
                                <input type="range" id="tier3Retention" min="50" max="100" value="90" step="1" oninput="document.getElementById('tier3RetentionVal').textContent=this.value+'%'">
                            </div>
                            <div class="input-group">
                                <label>Hours/Patient/Mo</label>
                                <input type="number" id="tier3Time" value="1" step="0.1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tier-section">
                    <div class="tier-header" onclick="toggleTier(4)">
                        <div class="tier-header-content">
                            <div class="tier-badge">T4</div>
                            <span class="tier-title">Tier 4</span>
                        </div>
                        <div class="tier-chevron">
                            <svg viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </div>
                    </div>
                    <div class="tier-content" id="tier4Content">
                        <div class="tier-inputs">
                            <div class="input-group">
                                <label>Monthly Price ($)</label>
                                <input type="number" id="tier4Price" value="0" step="5">
                            </div>
                            <div class="input-group">
                                <label>New Patients/Mo: <span id="tier4ClientsVal">0</span></label>
                                <input type="range" id="tier4Clients" min="0" max="50" value="0" step="1" oninput="document.getElementById('tier4ClientsVal').textContent=this.value">
                            </div>
                            <div class="input-group">
                                <label>Retention Rate: <span id="tier4RetentionVal">90%</span></label>
                                <input type="range" id="tier4Retention" min="50" max="100" value="90" step="1" oninput="document.getElementById('tier4RetentionVal').textContent=this.value+'%'">
                            </div>
                            <div class="input-group">
                                <label>Hours/Patient/Mo</label>
                                <input type="number" id="tier4Time" value="1.5" step="0.1" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="results-section">
            <!-- Year Selector -->
            <div class="year-selector glass-panel" style="padding: 16px 24px;" id="tourStep3">
                <button class="year-btn active" data-year="1" onclick="selectYear(1)">Year 1</button>
                <button class="year-btn" data-year="2" onclick="selectYear(2)">Year 2</button>
                <button class="year-btn" data-year="3" onclick="selectYear(3)">Year 3</button>
            </div>
            
            <div class="insights-bar">
                <div class="insight-item glass-panel">
                    <div class="insight-label">Break-Even</div>
                    <div class="insight-value" id="breakevenMonth">Month 2</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Final MRR</div>
                    <div class="insight-value" id="finalMRR">$4,050</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Patient LTV</div>
                    <div class="insight-value" id="patientLTV">$540</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Up-front Rate</div>
                    <div class="insight-value" id="oldHourlyRate">$75/hr</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Subscription Rate</div>
                    <div class="insight-value" id="newHourlyRate">$180/hr</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Up-front Util.</div>
                    <div class="insight-value positive" id="oldUtilization">8%</div>
                </div>
                <div class="insight-item glass-panel">
                    <div class="insight-label">Subscription Util.</div>
                    <div class="insight-value positive" id="newUtilization">52%</div>
                </div>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card glass-panel">
                    <div class="metric-label">Up-front Model</div>
                    <div class="metric-value" id="oldTotal">$18,000</div>
                    <div class="metric-subtext">Flat revenue</div>
                </div>
                <div class="metric-card glass-panel">
                    <div class="metric-label">Subscription</div>
                    <div class="metric-value" id="newTotal">$35,100</div>
                    <div class="metric-subtext">Compound growth</div>
                </div>
                <div class="metric-card glass-panel highlight">
                    <div class="metric-label">Combined Total</div>
                    <div class="metric-value" id="combinedTotalMetric">$53,100</div>
                    <div class="metric-subtext" id="percentText">Total income</div>
                </div>
            </div>
            
            <div class="charts-row" id="tourStep4">
                <div class="chart-container glass-panel">
                    <h3>Revenue Comparison</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-container glass-panel">
                    <h3>Active Patients</h3>
                    <canvas id="clientsChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container glass-panel">
                <h3>Cumulative Revenue</h3>
                <canvas id="cumulativeChart"></canvas>
            </div>
            
            <div class="table-container glass-panel">
                <h3>Monthly Breakdown</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Up-front</th>
                            <th>Old Pts</th>
                            <th>Subscription</th>
                            <th>New Pts</th>
                            <th>Combined</th>
                            <th>Î” vs Old</th>
                            <th>Old Hrs</th>
                            <th>New Hrs</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            
            <div class="disclaimer glass-panel">
                <div class="disclaimer-title">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
                    Important Disclaimer
                </div>
                <p class="disclaimer-text">
                    <strong>Reneu Wellness Club LLC does not guarantee these projections.</strong> All figures are estimates for illustrative purposes only. Actual results depend on patient volume, retention, provider availability, market conditions, regulatory changes, and individual performance. As an MSO, Reneu provides administrative support only. <strong>Clinical decisions remain solely with licensed providers.</strong> Consult qualified advisors before making business decisions.
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // Create 3D photon sphere particle system
        function createParticles() {
            const container = document.getElementById('particles');
            const numParticles = 120;
            
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Fibonacci sphere distribution for even coverage
                const phi = Math.acos(1 - 2 * (i + 0.5) / numParticles);
                const theta = Math.PI * (1 + Math.sqrt(5)) * i;
                
                const radius = 42; // percentage from center
                const x = 50 + radius * Math.sin(phi) * Math.cos(theta);
                const y = 50 + radius * Math.sin(phi) * Math.sin(theta);
                const z = Math.cos(phi);
                
                // Vary size based on z-depth for 3D effect
                const depthScale = 0.6 + (z + 1) / 2 * 0.4;
                const size = 1.5 * depthScale;
                
                particle.style.left = x + '%';
                particle.style.top = y + '%';
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                particle.style.opacity = 0.3 + depthScale * 0.5;
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animationDuration = (2.5 + Math.random() * 1.5) + 's';
                
                // Add slight z-index variation for depth
                particle.style.zIndex = Math.floor((z + 1) * 5);
                
                container.appendChild(particle);
            }
        }
        
        createParticles();
        
        // State
        let oldTimePeriod = 'monthly';
        let newTimePeriod = 'monthly';
        let selectedYear = 1;
        
        // Logo shrink on scroll
        const logoContainer = document.getElementById('logoContainer');
        window.addEventListener('scroll', () => {
            logoContainer.classList.toggle('scrolled', window.scrollY > 50);
        });
        
        // Toggle Functions
        function toggleOldTime() {
            const toggle = document.getElementById('oldTimeToggle');
            toggle.classList.toggle('active');
            oldTimePeriod = toggle.classList.contains('active') ? 'quarterly' : 'monthly';
            calculate();
        }
        
        function toggleNewTime() {
            const toggle = document.getElementById('newTimeToggle');
            toggle.classList.toggle('active');
            newTimePeriod = toggle.classList.contains('active') ? 'quarterly' : 'monthly';
            calculate();
        }
        
        function toggleTier(tier) {
            const header = event.currentTarget;
            const content = document.getElementById(`tier${tier}Content`);
            header.classList.toggle('active');
            content.classList.toggle('active');
        }
        
        function selectYear(year) {
            selectedYear = year;
            document.querySelectorAll('.year-btn').forEach(btn => {
                btn.classList.toggle('active', parseInt(btn.dataset.year) === year);
            });
            calculate();
        }
        
        // Slider value displays
        document.getElementById('oldClients').addEventListener('input', (e) => {
            document.getElementById('oldClientsVal').textContent = e.target.value;
        });
        document.getElementById('retention').addEventListener('input', (e) => {
            document.getElementById('retentionVal').textContent = e.target.value + '%';
        });
        document.getElementById('newClientsSteady').addEventListener('input', (e) => {
            document.getElementById('newClientsSteadyVal').textContent = e.target.value;
        });
        document.getElementById('startingPatients').addEventListener('input', (e) => {
            document.getElementById('startingPatientsVal').textContent = e.target.value;
        });
        
        // Tour System
        const tourSteps = [
            { target: 'tourStep0', title: 'Welcome', text: 'Compare revenue and capacity in a hybrid model where providers offer both up-front programs and subscriptions with multiple tiers.', position: 'bottom' },
            { target: 'tourStep1', title: 'Up-front Model', text: 'Configure one-time program pricing with capacity metrics. Toggle hours/patient between monthly and quarterly. Patients/month slider goes up to 50. View average hourly rate.', position: 'bottom' },
            { target: 'tourStep2', title: 'Subscription Model', text: 'Set base tier pricing and expand additional tiers (T2-T4) with unique pricing, retention, and capacity. New patients slider goes up to 100. Track average hourly rates.', position: 'top' },
            { target: 'tourStep3', title: 'Multi-Year View', text: 'Switch between Year 1, 2, and 3 to see long-term compound growth patterns across all tiers.', position: 'bottom' },
            { target: 'tourStep4', title: 'Analytics', text: 'View revenue comparisons, patient growth, break-even analysis, and comprehensive metrics across all tiers.', position: 'top' }
        ];
        
        let currentTourStep = 0, tourActive = false;
        
        function startTour() {
            if (tourActive) return;
            tourActive = true;
            currentTourStep = 0;
            document.getElementById('tourOrb').classList.add('touring');
            document.getElementById('tourOverlay').classList.add('visible');
            showTourStep(0);
        }
        
        function endTour() {
            tourActive = false;
            document.getElementById('tourOrb').classList.remove('touring');
            document.getElementById('tourOverlay').classList.remove('visible');
            document.getElementById('tourTooltip').classList.remove('visible');
            document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
            const orb = document.getElementById('tourOrb');
            orb.style.cssText = '';
        }
        
        function showTourStep(stepIndex) {
            const step = tourSteps[stepIndex];
            const target = document.getElementById(step.target);
            const orb = document.getElementById('tourOrb');
            const tooltip = document.getElementById('tourTooltip');
            
            document.querySelectorAll('.tour-highlight').forEach(el => el.classList.remove('tour-highlight'));
            target.classList.add('tour-highlight');
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            setTimeout(() => {
                const rect = target.getBoundingClientRect();
                let orbX = rect.left + rect.width / 2;
                let orbY = step.position === 'top' ? rect.top - 50 : rect.bottom + 30;
                
                orb.style.position = 'fixed';
                orb.style.left = orbX + 'px';
                orb.style.top = orbY + 'px';
                orb.style.bottom = 'auto';
                orb.style.right = 'auto';
                
                let tooltipX = orbX + 50, tooltipY = orbY - 50;
                if (tooltipX + 380 > window.innerWidth) tooltipX = orbX - 430;
                if (tooltipY + 270 > window.innerHeight) tooltipY = window.innerHeight - 280;
                if (tooltipY < 10) tooltipY = 10;
                if (tooltipX < 10) tooltipX = 10;
                
                tooltip.style.left = tooltipX + 'px';
                tooltip.style.top = tooltipY + 'px';
                document.getElementById('tooltipTitle').textContent = step.title;
                document.getElementById('tooltipText').textContent = step.text;
                document.getElementById('tourProgress').textContent = `${stepIndex + 1} of ${tourSteps.length}`;
                tooltip.querySelector('.tour-btn.next').textContent = stepIndex === tourSteps.length - 1 ? 'Done' : 'Next';
                tooltip.classList.add('visible');
            }, 200);
        }
        
        function nextTourStep() {
            currentTourStep++;
            if (currentTourStep >= tourSteps.length) endTour();
            else showTourStep(currentTourStep);
        }
        
        // Charts
        Chart.defaults.color = 'rgba(255, 255, 255, 0.4)';
        Chart.defaults.borderColor = 'rgba(248, 204, 116, 0.08)';
        
        let revenueChart, cumulativeChart, clientsChart;
        
        function calculate() {
            const oldPrice = parseFloat(document.getElementById('oldPrice').value) || 0;
            const oldClients = parseInt(document.getElementById('oldClients').value) || 0;
            const oldHoursPerWeek = parseFloat(document.getElementById('oldHoursPerWeek').value) || 20;
            const oldTimePerPatient = parseFloat(document.getElementById('oldTimePerPatient').value) || 0.5;
            
            // Base tier (Tier 1)
            const newPrice = parseFloat(document.getElementById('newPrice').value) || 0;
            const newClientsSteady = parseInt(document.getElementById('newClientsSteady').value) || 0;
            const startingPatients = parseInt(document.getElementById('startingPatients').value) || 0;
            const retention = (parseFloat(document.getElementById('retention').value) || 0) / 100;
            const hoursPerWeek = parseFloat(document.getElementById('hoursPerWeek').value) || 20;
            const newTimePerPatient = parseFloat(document.getElementById('newTimePerPatient').value) || 0.5;
            
            // Tier 2
            const tier2Price = parseFloat(document.getElementById('tier2Price').value) || 0;
            const tier2Clients = parseInt(document.getElementById('tier2Clients').value) || 0;
            const tier2Retention = (parseFloat(document.getElementById('tier2Retention').value) || 0) / 100;
            const tier2Time = parseFloat(document.getElementById('tier2Time').value) || 0;
            
            // Tier 3
            const tier3Price = parseFloat(document.getElementById('tier3Price').value) || 0;
            const tier3Clients = parseInt(document.getElementById('tier3Clients').value) || 0;
            const tier3Retention = (parseFloat(document.getElementById('tier3Retention').value) || 0) / 100;
            const tier3Time = parseFloat(document.getElementById('tier3Time').value) || 0;
            
            // Tier 4
            const tier4Price = parseFloat(document.getElementById('tier4Price').value) || 0;
            const tier4Clients = parseInt(document.getElementById('tier4Clients').value) || 0;
            const tier4Retention = (parseFloat(document.getElementById('tier4Retention').value) || 0) / 100;
            const tier4Time = parseFloat(document.getElementById('tier4Time').value) || 0;
            
            const oldMonthlyHoursAvailable = oldHoursPerWeek * 4.33;
            const newMonthlyHoursAvailable = hoursPerWeek * 4.33;
            
            // Convert time per patient to monthly hours
            const oldTimeMultiplier = oldTimePeriod === 'quarterly' ? 1/3 : 1;
            const newTimeMultiplier = newTimePeriod === 'quarterly' ? 1/3 : 1;
            const oldMonthlyHoursPerPatient = oldTimePerPatient * oldTimeMultiplier;
            const newMonthlyHoursPerPatient = newTimePerPatient * newTimeMultiplier;
            
            const avgMonths = retention < 1 ? 1 / (1 - retention) : 12;
            const patientLTV = newPrice * Math.min(avgMonths, 24);
            const oldMonthly = oldPrice * oldClients;
            
            const monthsToCalculate = selectedYear * 12;
            let activeClients = startingPatients;
            let activeTier2 = 0;
            let activeTier3 = 0;
            let activeTier4 = 0;
            let allData = [];
            let cumulativeOld = 0, cumulativeNew = 0, breakevenMonth = null;
            
            // Calculate subscription growth with proper compounding for all tiers
            for (let month = 1; month <= monthsToCalculate; month++) {
                // Apply retention and add new acquisitions for each tier
                activeClients = Math.round(activeClients * retention) + newClientsSteady;
                activeTier2 = Math.round(activeTier2 * tier2Retention) + tier2Clients;
                activeTier3 = Math.round(activeTier3 * tier3Retention) + tier3Clients;
                activeTier4 = Math.round(activeTier4 * tier4Retention) + tier4Clients;
                
                const tier1Revenue = activeClients * newPrice;
                const tier2Revenue = activeTier2 * tier2Price;
                const tier3Revenue = activeTier3 * tier3Price;
                const tier4Revenue = activeTier4 * tier4Price;
                const newMonthly = tier1Revenue + tier2Revenue + tier3Revenue + tier4Revenue;
                const monthlyDiff = newMonthly - oldMonthly;
                
                if (breakevenMonth === null && newMonthly >= oldMonthly) breakevenMonth = month;
                
                cumulativeOld += oldMonthly;
                cumulativeNew += newMonthly;
                
                const oldHoursRequired = oldClients * oldMonthlyHoursPerPatient;
                const newHoursRequired = (activeClients * newMonthlyHoursPerPatient) + 
                                        (activeTier2 * tier2Time) + 
                                        (activeTier3 * tier3Time) + 
                                        (activeTier4 * tier4Time);
                
                allData.push({ 
                    month, 
                    oldRevenue: oldMonthly, 
                    newRevenue: newMonthly, 
                    combinedRevenue: oldMonthly + newMonthly,
                    oldClients: oldClients,
                    activeClients: activeClients + activeTier2 + activeTier3 + activeTier4, 
                    monthlyDiff, 
                    cumulativeDiff: cumulativeNew - cumulativeOld,
                    cumulativeOld, 
                    cumulativeNew,
                    cumulativeCombined: cumulativeOld + cumulativeNew,
                    oldHoursRequired,
                    newHoursRequired 
                });
            }
            
            const displayData = allData.slice((selectedYear - 1) * 12, selectedYear * 12);
            const oldTotal = oldMonthly * 12;
            const newTotal = displayData.reduce((sum, d) => sum + d.newRevenue, 0);
            const combinedTotal = oldTotal + newTotal;
            const finalMonth = displayData[displayData.length - 1];
            
            // Calculate hourly rates
            const oldHourlyRate = finalMonth.oldHoursRequired > 0 ? finalMonth.oldRevenue / finalMonth.oldHoursRequired : 0;
            const newHourlyRate = finalMonth.newHoursRequired > 0 ? finalMonth.newRevenue / finalMonth.newHoursRequired : 0;
            
            const oldUtilization = (finalMonth.oldHoursRequired / oldMonthlyHoursAvailable) * 100;
            const newUtilization = (finalMonth.newHoursRequired / newMonthlyHoursAvailable) * 100;
            
            // Update insights
            document.getElementById('breakevenMonth').textContent = breakevenMonth ? `Month ${breakevenMonth}` : 'N/A';
            document.getElementById('finalMRR').textContent = '$' + Math.round(finalMonth.newRevenue).toLocaleString();
            document.getElementById('patientLTV').textContent = '$' + Math.round(patientLTV).toLocaleString();
            document.getElementById('oldHourlyRate').textContent = '$' + Math.round(oldHourlyRate) + '/hr';
            document.getElementById('newHourlyRate').textContent = '$' + Math.round(newHourlyRate) + '/hr';
            
            const oldUtilEl = document.getElementById('oldUtilization');
            oldUtilEl.textContent = Math.round(oldUtilization) + '%';
            oldUtilEl.className = 'insight-value ' + (oldUtilization > 100 ? 'negative' : oldUtilization > 80 ? '' : 'positive');
            
            const newUtilEl = document.getElementById('newUtilization');
            newUtilEl.textContent = Math.round(newUtilization) + '%';
            newUtilEl.className = 'insight-value ' + (newUtilization > 100 ? 'negative' : newUtilization > 80 ? '' : 'positive');
            
            document.getElementById('oldTotal').textContent = '$' + oldTotal.toLocaleString();
            document.getElementById('newTotal').textContent = '$' + Math.round(newTotal).toLocaleString();
            document.getElementById('combinedTotalMetric').textContent = '$' + Math.round(combinedTotal).toLocaleString();
            document.getElementById('percentText').textContent = 'Total income';
            
            updateTable(displayData);
            updateCharts(displayData);
        }
        
        function updateTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            let firstBreakeven = true;
            
            data.forEach((row, i) => {
                const tr = document.createElement('tr');
                if (row.monthlyDiff >= 0 && (i === 0 || data[i-1].monthlyDiff < 0) && firstBreakeven) { 
                    tr.className = 'breakeven-row'; 
                    firstBreakeven = false; 
                }
                
                const oldTime = row.oldHoursRequired.toFixed(1);
                const newTime = row.newHoursRequired.toFixed(1);
                const monthNum = (selectedYear - 1) * 12 + row.month;
                
                tr.innerHTML = `
                    <td><strong>Mo ${monthNum}</strong></td>
                    <td>$${Math.round(row.oldRevenue).toLocaleString()}</td>
                    <td>${row.oldClients}</td>
                    <td>$${Math.round(row.newRevenue).toLocaleString()}</td>
                    <td>${row.activeClients}</td>
                    <td><strong>$${Math.round(row.combinedRevenue).toLocaleString()}</strong></td>
                    <td class="${row.monthlyDiff >= 0 ? 'positive' : 'negative'}">${row.monthlyDiff >= 0 ? '+' : ''}$${Math.round(row.monthlyDiff).toLocaleString()}</td>
                    <td>${oldTime}</td>
                    <td>${newTime}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function updateCharts(data) {
            const months = data.map((d, i) => {
                const monthNum = (selectedYear - 1) * 12 + d.month;
                return 'Mo ' + monthNum;
            });
            const brand = '#f8cc74';
            const brandFill = 'rgba(248, 204, 116, 0.15)';
            const dim = 'rgba(248, 204, 116, 0.4)';
            const dimFill = 'rgba(248, 204, 116, 0.06)';
            const combined = 'rgba(110, 231, 183, 0.5)';
            const combinedFill = 'rgba(110, 231, 183, 0.1)';
            
            const opts = { 
                responsive: true, 
                maintainAspectRatio: true, 
                plugins: { 
                    legend: { 
                        labels: { 
                            color: 'rgba(255,255,255,0.5)', 
                            font: { family: "'Inter',sans-serif", size: 11 }, 
                            padding: 14 
                        } 
                    } 
                }, 
                scales: { 
                    x: { 
                        grid: { color: 'rgba(248,204,116,0.06)' }, 
                        ticks: { color: 'rgba(255,255,255,0.3)', font: { size: 10 } } 
                    }, 
                    y: { 
                        grid: { color: 'rgba(248,204,116,0.06)' }, 
                        ticks: { 
                            color: 'rgba(255,255,255,0.3)', 
                            font: { size: 10 }, 
                            callback: v => '$' + v.toLocaleString() 
                        }, 
                        beginAtZero: true 
                    } 
                } 
            };
            
            if (revenueChart) revenueChart.destroy();
            revenueChart = new Chart(document.getElementById('revenueChart').getContext('2d'), { 
                type: 'line', 
                data: { 
                    labels: months, 
                    datasets: [
                        { 
                            label: 'Up-front', 
                            data: data.map(d => d.oldRevenue), 
                            borderColor: dim, 
                            backgroundColor: dimFill, 
                            borderWidth: 2.5, 
                            tension: 0.2, 
                            pointRadius: 4, 
                            pointBackgroundColor: dim
                        }, 
                        { 
                            label: 'Subscription', 
                            data: data.map(d => Math.round(d.newRevenue)), 
                            borderColor: brand, 
                            backgroundColor: brandFill, 
                            borderWidth: 2.5, 
                            tension: 0.3, 
                            pointRadius: 4, 
                            pointBackgroundColor: brand
                        },
                        {
                            label: 'Combined',
                            data: data.map(d => Math.round(d.combinedRevenue)),
                            borderColor: combined,
                            backgroundColor: combinedFill,
                            borderWidth: 2.5,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: combined,
                            borderDash: [5, 5]
                        }
                    ] 
                }, 
                options: opts 
            });
            
            if (clientsChart) clientsChart.destroy();
            clientsChart = new Chart(document.getElementById('clientsChart').getContext('2d'), { 
                type: 'bar', 
                data: { 
                    labels: months, 
                    datasets: [
                        {
                            label: 'Up-front',
                            data: data.map(d => d.oldClients),
                            backgroundColor: 'rgba(248, 204, 116, 0.3)',
                            borderColor: dim,
                            borderWidth: 1.5,
                            borderRadius: 6
                        },
                        { 
                            label: 'Subscription', 
                            data: data.map(d => d.activeClients), 
                            backgroundColor: 'rgba(248, 204, 116, 0.5)', 
                            borderColor: brand, 
                            borderWidth: 1.5, 
                            borderRadius: 6 
                        }
                    ] 
                }, 
                options: { 
                    ...opts, 
                    scales: { 
                        ...opts.scales, 
                        y: { 
                            ...opts.scales.y, 
                            ticks: { 
                                ...opts.scales.y.ticks, 
                                callback: v => v 
                            } 
                        } 
                    } 
                } 
            });
            
            if (cumulativeChart) cumulativeChart.destroy();
            cumulativeChart = new Chart(document.getElementById('cumulativeChart').getContext('2d'), { 
                type: 'line', 
                data: { 
                    labels: months, 
                    datasets: [
                        { 
                            label: 'Up-front', 
                            data: data.map(d => d.cumulativeOld), 
                            borderColor: dim, 
                            backgroundColor: dimFill, 
                            borderWidth: 2.5, 
                            fill: true, 
                            tension: 0.2,
                            pointRadius: 4
                        }, 
                        { 
                            label: 'Subscription', 
                            data: data.map(d => Math.round(d.cumulativeNew)), 
                            borderColor: brand, 
                            backgroundColor: brandFill, 
                            borderWidth: 2.5, 
                            fill: true, 
                            tension: 0.3,
                            pointRadius: 4
                        },
                        {
                            label: 'Combined',
                            data: data.map(d => Math.round(d.cumulativeCombined)),
                            borderColor: combined,
                            backgroundColor: combinedFill,
                            borderWidth: 2.5,
                            fill: true,
                            tension: 0.3,
                            pointRadius: 4,
                            borderDash: [5, 5]
                        }
                    ] 
                }, 
                options: opts 
            });
        }
        
        document.querySelectorAll('input').forEach(input => input.addEventListener('input', calculate));
        calculate();
    </script>
</body>
</html>
